hostPort: dbz:1099
lowercaseOutputName: true
lowercaseOutputLabelNames: true
whitelistObjectNames:
  - "debezium.oracle:*"

# Convert CamelCase attribute names to snake_case
attrNameSnakeCase: true

rules:
  # =============================================================================
  # Streaming metrics - CDC change capture
  # =============================================================================

  # Total DML operations captured
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>TotalCapturedDmlCount'
    name: debezium_oracle_streaming_total_captured_dml
    help: Total DML operations captured
    type: COUNTER
    labels:
      server: "$1"

  # Last captured DML count in batch
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>LastCapturedDmlCount'
    name: debezium_oracle_streaming_last_captured_dml
    help: DML count in last batch
    type: GAUGE
    labels:
      server: "$1"

  # Max captured DML count in a batch
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>MaxCapturedDmlCountInBatch'
    name: debezium_oracle_streaming_max_captured_dml_batch
    help: Maximum DML count in a single batch
    type: GAUGE
    labels:
      server: "$1"

  # Current SCN being processed
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>CurrentScn'
    name: debezium_oracle_streaming_current_scn
    help: Current SCN being processed
    type: GAUGE
    labels:
      server: "$1"

  # Lag from source database
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>MillisecondsBehindSource'
    name: debezium_oracle_streaming_lag_ms
    help: Milliseconds behind source database
    type: GAUGE
    labels:
      server: "$1"

  # Milliseconds since last event
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>MillisecondsSinceLastEvent'
    name: debezium_oracle_streaming_ms_since_last_event
    help: Milliseconds since last event was processed
    type: GAUGE
    labels:
      server: "$1"

  # Number of events filtered
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>NumberOfEventsFiltered'
    name: debezium_oracle_streaming_events_filtered
    help: Number of events filtered out
    type: COUNTER
    labels:
      server: "$1"

  # Queue size
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>CurrentQueueSizeInBytes'
    name: debezium_oracle_streaming_queue_size_bytes
    help: Current queue size in bytes
    type: GAUGE
    labels:
      server: "$1"

  # Max queue size
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>MaxQueueSizeInBytes'
    name: debezium_oracle_streaming_max_queue_size_bytes
    help: Maximum queue size in bytes
    type: GAUGE
    labels:
      server: "$1"

  # Connected status
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>Connected'
    name: debezium_oracle_streaming_connected
    help: Whether connector is connected (1=true, 0=false)
    type: GAUGE
    labels:
      server: "$1"

  # Network connection problems
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>NetworkConnectionProblemsCounter'
    name: debezium_oracle_streaming_network_problems
    help: Number of network connection problems
    type: COUNTER
    labels:
      server: "$1"

  # Total events seen by type
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>TotalNumberOf(Create|Update|Delete)EventsSeen'
    name: debezium_oracle_streaming_events_$2
    help: Total number of $2 events seen
    type: COUNTER
    labels:
      server: "$1"

  # =============================================================================
  # Snapshot metrics
  # =============================================================================

  # Snapshot completed
  - pattern: 'debezium\.oracle<type=connector-metrics, context=snapshot, server=(.+)><>SnapshotCompleted'
    name: debezium_oracle_snapshot_completed
    help: Whether snapshot has completed (1=true, 0=false)
    type: GAUGE
    labels:
      server: "$1"

  # Rows scanned per table
  - pattern: 'debezium\.oracle<type=connector-metrics, context=snapshot, server=(.+), key=(.+)><>RowsScanned'
    name: debezium_oracle_snapshot_rows_scanned
    help: Rows scanned during snapshot
    type: GAUGE
    labels:
      server: "$1"
      table: "$2"

  # Remaining table count
  - pattern: 'debezium\.oracle<type=connector-metrics, context=snapshot, server=(.+)><>RemainingTableCount'
    name: debezium_oracle_snapshot_remaining_tables
    help: Number of tables remaining to snapshot
    type: GAUGE
    labels:
      server: "$1"

  # =============================================================================
  # Schema history metrics
  # =============================================================================

  - pattern: 'debezium\.oracle<type=connector-metrics, context=schema-history, server=(.+)><>ChangesApplied'
    name: debezium_oracle_schema_changes_applied
    help: Number of schema changes applied
    type: COUNTER
    labels:
      server: "$1"

  - pattern: 'debezium\.oracle<type=connector-metrics, context=schema-history, server=(.+)><>MillisecondsSinceLastAppliedChange'
    name: debezium_oracle_schema_ms_since_last_change
    help: Milliseconds since last schema change
    type: GAUGE
    labels:
      server: "$1"

  # =============================================================================
  # Catch-all for remaining metrics (with proper snake_case conversion)
  # =============================================================================

  # Streaming context catch-all
  - pattern: 'debezium\.oracle<type=connector-metrics, context=streaming, server=(.+)><>(\w+)'
    name: debezium_oracle_streaming_$2
    help: Debezium Oracle streaming metric
    type: UNTYPED
    labels:
      server: "$1"

  # Snapshot context catch-all (without key)
  - pattern: 'debezium\.oracle<type=connector-metrics, context=snapshot, server=([^,]+)><>(\w+)'
    name: debezium_oracle_snapshot_$2
    help: Debezium Oracle snapshot metric
    type: UNTYPED
    labels:
      server: "$1"

  # Schema history context catch-all
  - pattern: 'debezium\.oracle<type=connector-metrics, context=schema-history, server=(.+)><>(\w+)'
    name: debezium_oracle_schema_$2
    help: Debezium Oracle schema history metric
    type: UNTYPED
    labels:
      server: "$1"
